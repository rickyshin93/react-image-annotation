"use strict";(self.webpackChunk_rockshin_react_image_annotation=self.webpackChunk_rockshin_react_image_annotation||[]).push([["904"],{"./stories/image-annotator.stories.ts":function(e,t,a){a.r(t),a.d(t,{WithMixedSizeImages:()=>C,WithPreExistingAnnotations:()=>y,WithCallbacks:()=>b,WithAutoTriggers:()=>w,WithSmallImage:()=>A,WithLargeImage:()=>S,WithMultipleImages:()=>v,default:()=>u,__namedExportsOrder:()=>I,WithCustomTools:()=>x,Basic:()=>f}),a("./node_modules/.pnpm/tldraw@3.6.1_@types+react@18.3.18_react-dom@18.3.1_react@18.3.1/node_modules/tldraw/tldraw.css");var n=a("./node_modules/.pnpm/react@18.3.1/node_modules/react/jsx-runtime.js"),r=a("./node_modules/.pnpm/react@18.3.1/node_modules/react/index.js"),o=a("./node_modules/.pnpm/tldraw@3.6.1_@types+react@18.3.18_react-dom@18.3.1_react@18.3.1/node_modules/tldraw/dist-esm/index.mjs");let s=e=>{let{onClick:t}=e;return(0,n.jsx)("button",{className:"px-4 py-2 bg-blue-500 text-white rounded-lg z-[300] font-bold pointer-events-auto hover:bg-blue-600 m-2",onClick:t,children:"Done"})};s.__docgenInfo={description:"",methods:[],displayName:"CustomDoneButton",props:{onClick:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};var i=a("./node_modules/.pnpm/react-icons@5.4.0_react@18.3.1/node_modules/react-icons/gr/index.mjs");let l=e=>(0,n.jsxs)("div",{className:"flex h-10 z-[300] pointer-events-auto bg-[var(--color-low)] py-1 px-2 rounded-b-lg gap-2",children:[(0,n.jsx)("button",{className:"flex-none w-10 cursor-pointer px-2 hover:bg-[#00000010] rounded-lg",onClick:e.onPrevious,children:(0,n.jsx)(i.o8k,{color:"#2E2E2E",size:24})}),(0,n.jsxs)("span",{className:"flex items-center justify-center text-sm font-medium text-[var(--color-text-1)]",children:[e.currentIndex," / ",e.totalCount]}),(0,n.jsx)("button",{className:"flex-none w-10 cursor-pointer px-2 hover:bg-[#00000010] rounded-lg",onClick:e.onNext,children:(0,n.jsx)(i.zSJ,{className:"",size:24,color:"var(--color-text-1)"})})]});l.__docgenInfo={description:"",methods:[],displayName:"TopPanel",props:{onPrevious:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onNext:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},currentIndex:{required:!0,tsType:{name:"number"},description:""},totalCount:{required:!0,tsType:{name:"number"},description:""}}};let d=async e=>{let t;if(e.startsWith("data:")){let a=e.split(",")[1],n=e.split(",")[0].split(":")[1].split(";")[0],r=atob(a),o=new ArrayBuffer(r.length),s=new Uint8Array(o);for(let e=0;e<r.length;e++)s[e]=r.charCodeAt(e);t=new Blob([o],{type:n})}else t=await fetch(e).then(e=>e.blob());let a=await o.P60.blobToDataUrl(t),{w:n,h:r}=await o.xeI.getImageSize(t);return{src:a,width:n,height:r,type:t.type}};function c(e,t){if(!e)return;let a=e.getShape(t);if(!a)return;let n=e.getCurrentPageId();a.parentId!==n&&e.moveShapesToPage([a],n);let r=e.getSortedChildIdsForParent(n);e.getShape(r[0]).id!==t&&e.sendToBack([a])}let p=e=>{if(!e)return[];let t=[];return e.getCurrentPageShapes().forEach(e=>{if("geo"===e.type&&"rectangle"===e.props.geo){let a={x:e.x,y:e.y,width:e.props.w,height:e.props.h},n={id:e.id,x:a.x,y:a.y,width:a.width,height:a.height,rotation:e.rotation||0,type:"rectangle",label:e.props.text||"",timestamp:Date.now(),metadata:{color:e.props.color||"default",createdBy:"user",modifiedAt:Date.now(),version:1,tags:[],isVerified:!1}};t.push(n)}}),t};function m(e){let{images:t,tools:a,initialImageIndex:i=0,outputTriggerOn:m,onDone:u,onAnnotationCreated:g,onAnnotationChange:h,onAnnotationDeleted:f,onImageChange:y}=e;if(0===t.length)return(0,n.jsx)("div",{children:"Please provided at least one image"});let{eraser:x,text:b}=a||{},[w,v]=(0,r.useState)(null),[S,A]=(0,r.useState)(null),[C,I]=(0,r.useState)(i<t.length?i:0),[k,E]=(0,r.useState)(null),[_,j]=(0,r.useState)(new Set),[D,T]=(0,r.useState)([]),W=(0,r.useRef)(!1),N=(0,r.useRef)(0);(0,r.useEffect)(()=>{(async()=>{E({...await d(t[C].src),id:t[C].id||(0,o.ELf)()});let e=new Set;t[C].annotations.forEach(t=>{if(t.label){let a=parseInt(t.label);!isNaN(a)&&e.add(a)}}),j(e),T([])})()},[C,t]);(0,r.useEffect)(()=>{S&&w&&k&&t[C].annotations.forEach(e=>{var t,a;let n=e.id||(0,o.F17)();S.createShape({id:n,type:"geo",x:e.x,y:e.y,rotation:e.rotation,props:{geo:"rectangle",w:e.width,h:e.height,text:e.label||"",color:(null===(t=e.metadata)||void 0===t?void 0:t.color)||"default",labelColor:(null===(a=e.metadata)||void 0===a?void 0:a.color)||"default"}})})},[S,w,k]);let P=(0,r.useCallback)(async()=>{if(!S||!k)return;let e=p(S);null==u||u({annotations:e,image:{id:k.id,src:t[C].src}})},[u,S,k,t,C]),V=()=>{if(D.length>0){let e=Math.min(...D);return T(t=>t.filter(t=>t!==e)),j(t=>{let a=new Set(t);return a.add(e),a}),e.toString()}let e=1;for(;_.has(e);)e++;return e>999?(console.warn("Exceeded maximum number of annotations (999)"),"999"):(j(t=>{let a=new Set(t);return a.add(e),a}),e.toString())};(0,r.useEffect)(()=>{if(!S)return;let e=null,t=()=>{if(e){let t=S.getShape(e);if(t&&"geo"===t.type&&"rectangle"===t.props.geo){let e=V();S.updateShape({id:t.id,type:"geo",props:{...t.props,labelColor:"red",text:e}});let a={id:t.id,x:t.x,y:t.y,width:t.props.w,height:t.props.h,rotation:t.rotation||0,label:e,timestamp:Date.now(),metadata:{color:t.props.color,createdBy:"user",modifiedAt:Date.now(),version:1,tags:[],isVerified:!1}};null==g||g({image:{id:null==k?void 0:k.id},annotation:a}),(null==m?void 0:m.created)&&P()}e=null}},a=async(t,a)=>{if(W.current)return;let{prev:n}=a||{};if(!n||n.id===e)return;let r=Date.now();if("change"===t&&r-N.current<50)return;N.current=r;let o={id:n.id,x:n.x,y:n.y,width:n.props.w,height:n.props.h,rotation:n.rotation,label:n.props.text,timestamp:Date.now(),metadata:{color:n.props.color,createdBy:"user",modifiedAt:Date.now(),version:1,tags:[],isVerified:!1}};if("delete"===t){let e=parseInt(n.props.text);!isNaN(e)&&(T(t=>[...t,e].sort((e,t)=>e-t)),j(t=>{let a=new Set(t);return a.delete(e),a})),null==f||f({image:{id:null==k?void 0:k.id},annotation:o}),(null==m?void 0:m.deleted)&&P()}else"change"===t&&(null==h||h({image:{id:null==k?void 0:k.id},annotation:o}),(null==m?void 0:m.changed)&&P())},n=(0,o.DsO)(()=>{P()},50),r=(0,o.DsO)(a,100),s=S.sideEffects.registerAfterCreateHandler("shape",t=>{"geo"===t.type&&"rectangle"===t.props.geo&&(e=t.id)}),i=S.sideEffects.registerAfterChangeHandler("shape",(e,t)=>r("change",{prev:e,next:t})),l=S.sideEffects.registerAfterDeleteHandler("shape",e=>a("delete",{prev:e}));return S.on("event",e=>{"pointer_up"===e.name&&t()}),()=>{s(),i(),l(),n.cancel(),r.cancel()}},[S,w,p,P,V]),(0,r.useEffect)(()=>{if(!S||!k)return;let e=o.Ykc.createId();S.createAssets([{id:e,typeName:"asset",type:"image",meta:{},props:{w:k.width,h:k.height,mimeType:k.type,src:k.src,name:`image-${e}`,isAnimated:!1}}]);let t=(0,o.F17)();S.createShape({id:t,type:"image",x:0,y:0,isLocked:!0,props:{w:k.width,h:k.height,assetId:e}});let a=S.sideEffects.registerAfterCreateHandler("shape",()=>c(S,t)),n=S.sideEffects.registerAfterChangeHandler("shape",()=>c(S,t)),r=S.sideEffects.registerBeforeChangeHandler("shape",(e,a)=>a.id!==t||a.isLocked?a:{...e,isLocked:!0});return S.clearHistory(),v(t),()=>{n(),a(),r()}},[S,null==k?void 0:k.id]),(0,r.useEffect)(()=>{S&&k&&w&&(S.setCameraOptions({constraints:{initialZoom:"fit-max-100",baseZoom:"default",bounds:{w:k.width,h:k.height,x:0,y:0},padding:{x:16,y:16},origin:{x:.5,y:.5},behavior:"free"},zoomSteps:[.5,1,2,4,8],zoomSpeed:1,panSpeed:1,isLocked:!1}),S.setCamera(S.getCamera(),{reset:!0}))},[S,w,k]);let q=(0,r.useCallback)(e=>{W.current=!0,null==S||S.run(()=>{null==S||S.deleteShapes(Array.from(S.getCurrentPageShapeIds()))},{ignoreShapeLock:!0}),v(null),I(a=>"prev"===e?0===a?t.length-1:a-1:a===t.length-1?0:a+1),setTimeout(()=>{W.current=!1},100)},[S,t.length]),B=(0,r.useCallback)(()=>q("prev"),[q]),z=(0,r.useCallback)(()=>q("next"),[q]);return(0,r.useEffect)(()=>{null==y||y({index:C,image:{id:t[C].id||"",src:t[C].src}})},[C]),(0,r.useEffect)(()=>{W.current&&S&&k&&setTimeout(()=>{P()},100)},[C]),(0,n.jsx)("div",{className:"absolute inset-0",children:(0,n.jsx)(o.DrV,{onMount:function(e){A(e),e.setStyleForNextShapes(o.R_W,"red"),e.setStyleForNextShapes(o.ST$,"s"),e.setStyleForNextShapes(o.Y8S,"mono")},components:{Toolbar:e=>{let t=(0,o.b55)(),a=(0,o.EA)(t.select),r=(0,o.EA)(t.rectangle),s=(0,o.EA)(t.text),i=(0,o.EA)(t.eraser),l=(0,o.EA)(t.hand);return(0,n.jsxs)(o.DhQ,{...e,children:[(0,n.jsx)(o.hEi,{...t.select,isSelected:a}),(0,n.jsx)(o.hEi,{...t.hand,isSelected:l}),(null==x?void 0:x.enabled)&&(0,n.jsx)(o.hEi,{...t.eraser,isSelected:i}),(null==b?void 0:b.enabled)&&(0,n.jsx)(o.hEi,{...t.text,isSelected:s}),(0,n.jsx)(o.hEi,{...t.rectangle,isSelected:r})]})},PageMenu:null,ActionsMenu:null,StylePanel:null,TopPanel:(0,r.useCallback)(()=>(0,n.jsx)(l,{onPrevious:B,onNext:z,currentIndex:C+1,totalCount:t.length}),[w,u]),SharePanel:(0,r.useCallback)(()=>(0,n.jsx)(s,{onClick:P}),[w,s])}})})}m.__docgenInfo={description:"",methods:[],displayName:"ImageAnnotationEditor",props:{images:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:"{\n  id?: string\n  src: string\n  annotations: Annotation[]\n}",signature:{properties:[{key:"id",value:{name:"string",required:!1}},{key:"src",value:{name:"string",required:!0}},{key:"annotations",value:{name:"Array",elements:[{name:"Annotation"}],raw:"Annotation[]",required:!0}}]}}],raw:"{\n  id?: string\n  src: string\n  annotations: Annotation[]\n}[]"},description:""},initialImageIndex:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"0",computed:!1}},tools:{required:!1,tsType:{name:"signature",type:"object",raw:"{\n  eraser?: {\n    enabled?: boolean\n  }\n  text?: {\n    enabled?: boolean\n  }\n}",signature:{properties:[{key:"eraser",value:{name:"signature",type:"object",raw:"{\n  enabled?: boolean\n}",signature:{properties:[{key:"enabled",value:{name:"boolean",required:!1}}]},required:!1}},{key:"text",value:{name:"signature",type:"object",raw:"{\n  enabled?: boolean\n}",signature:{properties:[{key:"enabled",value:{name:"boolean",required:!1}}]},required:!1}}]}},description:""},outputTriggerOn:{required:!1,tsType:{name:"signature",type:"object",raw:"{\n  created?: boolean\n  changed?: boolean\n  deleted?: boolean\n}",signature:{properties:[{key:"created",value:{name:"boolean",required:!1}},{key:"changed",value:{name:"boolean",required:!1}},{key:"deleted",value:{name:"boolean",required:!1}}]}},description:""}}};let u={title:"Components/ImageAnnotator",component:m,parameters:{layout:"fullscreen"}},g=[{id:"image0",src:"https://fastly.picsum.photos/id/930/900/600.jpg?hmac=-VvyG-XjlLRggW6xtMd4UHBwxXJ-O8g7EVRpKm9DW0s",annotations:[{id:"shape:s-MMqyY_DlysR5i_Dr-cw",x:570.6616220075775,y:234.7749303606369,width:198.69671630859375,height:131.31036376953125,rotation:5.3756140961425345,type:"rectangle",label:"5",timestamp:0x194698b888c,metadata:{color:"red",createdBy:"user",modifiedAt:0x194698b888c,version:1,tags:[],isVerified:!1}},{id:"shape:1-yh2opbFbOpEprcNPdKS",x:83.45930325359515,y:193.02561725714776,width:124.84748947006867,height:123.61206136850944,rotation:5.3756140961425345,type:"rectangle",label:"1",timestamp:0x194698b888c,metadata:{color:"red",createdBy:"user",modifiedAt:0x194698b888c,version:1,tags:[],isVerified:!1}},{id:"shape:Hp9GrZ00ldwLN0CpWkcXY",x:154.38957623531536,y:305.0142249484778,width:248.734083670453,height:229.15347678557805,rotation:0,type:"rectangle",label:"2",timestamp:0x194698b888c,metadata:{color:"red",createdBy:"user",modifiedAt:0x194698b888c,version:1,tags:[],isVerified:!1}},{id:"shape:sw4HvspZ2ScsJ68k6Ejm7",x:451.2897707321237,y:142.1256360707238,width:129.70425985164417,height:108.62586997703193,rotation:5.3930673886624785,type:"rectangle",label:"3",timestamp:0x194698b888c,metadata:{color:"red",createdBy:"user",modifiedAt:0x194698b888c,version:1,tags:[],isVerified:!1}},{id:"shape:cPtiRk5d-0bboKDQSoMO9",x:586.2918704226382,y:368.4326594858195,width:278.90842602679845,height:142.37716236564358,rotation:.29670597283903605,type:"rectangle",label:"4",timestamp:0x194698b888c,metadata:{color:"red",createdBy:"user",modifiedAt:0x194698b888c,version:1,tags:[],isVerified:!1}},{id:"shape:5NSqVehqe8IlFmYaW7PsP",x:308.8582223671702,y:260.60060508073525,width:154.5696085710519,height:182.23682110566017,rotation:0,type:"rectangle",label:"6",timestamp:0x194698b888c,metadata:{color:"red",createdBy:"user",modifiedAt:0x194698b888c,version:1,tags:[],isVerified:!1}}]},{id:"image1",src:"https://fastly.picsum.photos/id/106/900/600.jpg?hmac=xA_tP1jGHJrWhLPmViP6lnLck6pqCmDXQP8Q9H1IPgs",annotations:[]},{id:"image2",src:"https://fastly.picsum.photos/id/574/800/601.jpg?hmac=DZb2oYbpWGCSpPwqhs4_H0Uvk2VoizaQWddhQIVhRFE",annotations:[]},{id:"image3",src:"https://fastly.picsum.photos/id/372/800/600.jpg?hmac=911lXwSe0NWznaFWKm3nVrZV7y1IypKxlpDUIVpKxVs",annotations:[]},{id:"image4",src:"https://fastly.picsum.photos/id/1057/800/600.jpg?hmac=YmA5NCeEgXc1TOldOXFtXzaMW1NWH-IG92zNgLmTcDQ",annotations:[]},{id:"image5",src:"https://fastly.picsum.photos/id/705/900/600.jpg?hmac=bzZzT6Zhu_ybVXbEhA8WipVgd9fxGXYNmZgaApMKHBY",annotations:[]}],h=[{id:"image1",src:"https://fastly.picsum.photos/id/727/800/602.jpg?hmac=TXud4Hami5cc6oxCzbuVUHoTIeP-nNVcU8A1VtS11XE",annotations:[{id:"shape:1",x:100,y:100,width:200,height:150,rotation:0,label:"1",timestamp:Date.now(),metadata:{color:"red",createdBy:"user",modifiedAt:Date.now(),version:1,tags:[],isVerified:!1}}]}],f={args:{images:g}},y={args:{images:h}},x={args:{images:g,tools:{eraser:{enabled:!0},text:{enabled:!0}}}},b={args:{images:g,outputTriggerOn:{created:!0,changed:!0,deleted:!0},onAnnotationCreated:e=>{console.log("Annotation created:",e)},onAnnotationChange:e=>{console.log("Annotation changed:",e)},onAnnotationDeleted:e=>{console.log("Annotation deleted:",e)},onImageChange:e=>{console.log("Image changed:",e)},onDone:e=>{console.log("Done clicked:",e)}}},w={args:{images:g,outputTriggerOn:{created:!0,changed:!0,deleted:!0},onDone:e=>{console.log("Auto-triggered on change:",e)}}},v={args:{images:[,,,,,].fill(null).map((e,t)=>({id:`image${t+1}`,src:`https://picsum.photos/800/${600+t}`,annotations:[]})),initialImageIndex:0}},S={args:{images:[{id:"large-image",src:"https://picsum.photos/2000/1500",annotations:[]}]}},A={args:{images:[{id:"small-image",src:"https://picsum.photos/400/300",annotations:[]}]}},C={args:{images:[{id:"small",src:"https://picsum.photos/400/300",annotations:[]},{id:"medium",src:"https://picsum.photos/800/600",annotations:[]},{id:"large",src:"https://picsum.photos/1600/1200",annotations:[]}]}},I=["Basic","WithPreExistingAnnotations","WithCustomTools","WithCallbacks","WithAutoTriggers","WithMultipleImages","WithLargeImage","WithSmallImage","WithMixedSizeImages"];f.parameters={...f.parameters,docs:{...f.parameters?.docs,source:{originalSource:"{\n  args: {\n    images: sampleImages\n  }\n}",...f.parameters?.docs?.source}}},y.parameters={...y.parameters,docs:{...y.parameters?.docs,source:{originalSource:"{\n  args: {\n    images: imagesWithAnnotations\n  }\n}",...y.parameters?.docs?.source}}},x.parameters={...x.parameters,docs:{...x.parameters?.docs,source:{originalSource:"{\n  args: {\n    images: sampleImages,\n    tools: {\n      eraser: {\n        enabled: true\n      },\n      text: {\n        enabled: true\n      }\n    }\n  }\n}",...x.parameters?.docs?.source}}},b.parameters={...b.parameters,docs:{...b.parameters?.docs,source:{originalSource:"{\n  args: {\n    images: sampleImages,\n    outputTriggerOn: {\n      created: true,\n      changed: true,\n      deleted: true\n    },\n    onAnnotationCreated: annotation => {\n      console.log('Annotation created:', annotation);\n    },\n    onAnnotationChange: annotation => {\n      console.log('Annotation changed:', annotation);\n    },\n    onAnnotationDeleted: annotation => {\n      console.log('Annotation deleted:', annotation);\n    },\n    onImageChange: data => {\n      console.log('Image changed:', data);\n    },\n    onDone: data => {\n      console.log('Done clicked:', data);\n    }\n  }\n}",...b.parameters?.docs?.source}}},w.parameters={...w.parameters,docs:{...w.parameters?.docs,source:{originalSource:"{\n  args: {\n    images: sampleImages,\n    outputTriggerOn: {\n      created: true,\n      changed: true,\n      deleted: true\n    },\n    onDone: data => {\n      console.log('Auto-triggered on change:', data);\n    }\n  }\n}",...w.parameters?.docs?.source}}},v.parameters={...v.parameters,docs:{...v.parameters?.docs,source:{originalSource:"{\n  args: {\n    images: Array(5).fill(null).map((_, i) => ({\n      id: `image${i + 1}`,\n      src: `https://picsum.photos/800/${600 + i}`,\n      annotations: []\n    })),\n    initialImageIndex: 0\n  }\n}",...v.parameters?.docs?.source}}},S.parameters={...S.parameters,docs:{...S.parameters?.docs,source:{originalSource:"{\n  args: {\n    images: [{\n      id: 'large-image',\n      src: 'https://picsum.photos/2000/1500',\n      annotations: []\n    }]\n  }\n}",...S.parameters?.docs?.source}}},A.parameters={...A.parameters,docs:{...A.parameters?.docs,source:{originalSource:"{\n  args: {\n    images: [{\n      id: 'small-image',\n      src: 'https://picsum.photos/400/300',\n      annotations: []\n    }]\n  }\n}",...A.parameters?.docs?.source}}},C.parameters={...C.parameters,docs:{...C.parameters?.docs,source:{originalSource:"{\n  args: {\n    images: [{\n      id: 'small',\n      src: 'https://picsum.photos/400/300',\n      annotations: []\n    }, {\n      id: 'medium',\n      src: 'https://picsum.photos/800/600',\n      annotations: []\n    }, {\n      id: 'large',\n      src: 'https://picsum.photos/1600/1200',\n      annotations: []\n    }]\n  }\n}",...C.parameters?.docs?.source}}}}}]);